<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>劳动法加班费计算器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- PDF生成库 -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        header {
            background: linear-gradient(135deg, #1a5fb4 0%, #2d87d0 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 28px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        header h1 i {
            font-size: 32px;
        }
        
        header p {
            opacity: 0.9;
            font-size: 16px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .content-wrapper {
            display: flex;
            flex-wrap: wrap;
            padding: 0;
        }
        
        .input-section {
            flex: 1;
            min-width: 300px;
            padding: 30px;
            background-color: #f9fbfd;
            border-right: 1px solid #eaeef2;
        }
        
        .result-section {
            flex: 1.2;
            min-width: 350px;
            padding: 30px;
        }
        
        .section-title {
            font-size: 20px;
            color: #1a5fb4;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eaeef2;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            font-size: 22px;
        }
        
        .input-group {
            margin-bottom: 22px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }
        
        input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #d0d7e2;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #1a5fb4;
            box-shadow: 0 0 0 3px rgba(26, 95, 180, 0.1);
        }
        
        .input-hint {
            font-size: 13px;
            color: #666;
            margin-top: 6px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex: 1;
            min-width: 160px;
        }
        
        .calculate-btn {
            background: linear-gradient(to right, #1a5fb4, #2d87d0);
            color: white;
        }
        
        .calculate-btn:hover {
            background: linear-gradient(to right, #16529f, #2474b8);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 95, 180, 0.2);
        }
        
        .download-btn {
            background: linear-gradient(to right, #26a269, #2ec27e);
            color: white;
        }
        
        .download-btn:hover {
            background: linear-gradient(to right, #208e5c, #28a870);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(38, 162, 105, 0.2);
        }
        
        .result-box {
            background-color: #f0f7ff;
            border-radius: 10px;
            padding: 25px;
            margin-top: 15px;
            border-left: 5px solid #1a5fb4;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #d0d7e2;
        }
        
        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .result-label {
            font-weight: 600;
            color: #444;
        }
        
        .result-value {
            font-weight: 700;
            color: #1a5fb4;
            font-size: 18px;
        }
        
        .total {
            background-color: #e6f2ff;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid #1a5fb4;
        }
        
        .total-label {
            font-size: 20px;
            font-weight: 700;
            color: #1a5fb4;
        }
        
        .total-value {
            font-size: 28px;
            font-weight: 800;
            color: #1a5fb4;
        }
        
        .calculation-details {
            margin-top: 25px;
            padding: 20px;
            background-color: #f9fbfd;
            border-radius: 8px;
            font-size: 14px;
            color: #555;
            line-height: 1.7;
        }
        
        .law-section {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin-top: 30px;
        }
        
        .law-item {
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid #eaeef2;
        }
        
        .law-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .law-item h3 {
            color: #1a5fb4;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .law-item p {
            color: #444;
            margin-bottom: 8px;
        }
        
        .law-source {
            font-size: 13px;
            color: #666;
            font-style: italic;
            margin-top: 10px;
        }
        
        .law-link {
            color: #1a5fb4;
            text-decoration: none;
            font-weight: 600;
        }
        
        .law-link:hover {
            text-decoration: underline;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eaeef2;
            color: #666;
            font-size: 14px;
        }
        
        .footer a {
            color: #1a5fb4;
            text-decoration: none;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
        
        .note {
            background-color: #fff8e6;
            border-left: 4px solid #ffa500;
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .content-wrapper {
                flex-direction: column;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 1px solid #eaeef2;
            }
            
            button {
                min-width: 100%;
            }
            
            header h1 {
                font-size: 24px;
            }
        }
        
        .formula {
            background-color: #f0f7ff;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border-left: 3px solid #1a5fb4;
        }
        
        .download-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .pdf-btn {
            background: linear-gradient(to right, #c64600, #e55c00);
            color: white;
            padding: 10px 15px;
            font-size: 14px;
            min-width: 120px;
        }
        
        .pdf-btn:hover {
            background: linear-gradient(to right, #b03d00, #cc5200);
        }
        
        /* 专门用于PDF生成的样式 - 在页面上隐藏 */
        .pdf-header {
            display: none;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #1a5fb4 0%, #2d87d0 100%);
            color: white;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .pdf-footer {
            display: none;
            text-align: center;
            padding: 15px;
            color: #666;
            font-size: 12px;
            border-top: 1px solid #eee;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container" id="contentToExport">
        <header>
            <h1><i class="fas fa-calculator"></i> 劳动法加班费计算器</h1>
            <p>根据《中华人民共和国劳动法》及相关规定计算加班工资。自2025年1月1日起，法定节假日增加至13天。</p>
        </header>
        
        <div class="content-wrapper">
            <section class="input-section">
                <h2 class="section-title"><i class="fas fa-edit"></i> 输入加班信息</h2>
                
                <div class="input-group">
                    <label for="monthlySalary"><i class="fas fa-money-bill-wave"></i> 月工资收入（元）</label>
                    <input type="number" id="monthlySalary" placeholder="例如：8000" min="0" step="100" value="8000">
                    <div class="input-hint"><i class="fas fa-info-circle"></i> 请输入您的税前月工资</div>
                </div>
                
                <div class="input-group">
                    <label for="weekdayOvertime"><i class="fas fa-briefcase"></i> 工作日加班时长（小时）</label>
                    <input type="number" id="weekdayOvertime" placeholder="例如：10" min="0" step="0.5" value="10">
                    <div class="input-hint"><i class="fas fa-info-circle"></i> 工作日延长工作时间的加班时数</div>
                </div>
                
                <div class="input-group">
                    <label for="weekendOvertime"><i class="fas fa-calendar-weekend"></i> 周末加班时长（小时）</label>
                    <input type="number" id="weekendOvertime" placeholder="例如：8" min="0" step="0.5" value="8">
                    <div class="input-hint"><i class="fas fa-info-circle"></i> 周六、周日加班的时数</div>
                </div>
                
                <div class="input-group">
                    <label for="holidayOvertime"><i class="fas fa-calendar-day"></i> 节假日加班时长（小时）</label>
                    <input type="number" id="holidayOvertime" placeholder="例如：8" min="0" step="0.5" value="8">
                    <div class="input-hint"><i class="fas fa-info-circle"></i> 法定节假日加班的时数（2025年起全年13天）</div>
                </div>
                
                <div class="note">
                    <strong><i class="fas fa-lightbulb"></i> 计算说明：</strong> 本计算器适用于标准工时制。月计薪天数固定为21.75天，日工资 = 月工资 ÷ 21.75，小时工资 = 日工资 ÷ 8。
                </div>
                
                <div class="buttons">
                    <button class="calculate-btn" id="calculateBtn">
                        <i class="fas fa-calculator"></i> 计算加班费
                    </button>
                    <button class="download-btn" id="downloadTxtBtn">
                        <i class="fas fa-file-alt"></i> 下载文本结果
                    </button>
                </div>
                
                <div class="download-options">
                    <button class="pdf-btn" id="downloadPdfBtn">
                        <i class="fas fa-file-pdf"></i> 导出完整PDF
                    </button>
                </div>
            </section>
            
            <section class="result-section">
                <h2 class="section-title"><i class="fas fa-chart-bar"></i> 计算结果</h2>
                
                <div class="result-box">
                    <div class="result-item">
                        <span class="result-label">日工资</span>
                        <span class="result-value" id="dailySalary">367.82 元</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">小时工资</span>
                        <span class="result-value" id="hourlySalary">45.98 元</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">工作日加班费 (150%)</span>
                        <span class="result-value" id="weekdayOvertimePay">689.66 元</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">周末加班费 (200%)</span>
                        <span class="result-value" id="weekendOvertimePay">735.63 元</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">节假日加班费 (300%)</span>
                        <span class="result-value" id="holidayOvertimePay">1103.45 元</span>
                    </div>
                    
                    <div class="total">
                        <span class="total-label">加班费总计</span>
                        <span class="total-value" id="totalOvertimePay">2528.74 元</span>
                    </div>
                </div>
                
                <div class="calculation-details">
                    <h3><i class="fas fa-cogs"></i> 计算明细</h3>
                    <div class="formula">
                        月计薪天数 = (365天 - 104天休息日) ÷ 12月 = 21.75天<br>
                        日工资 = 月工资 ÷ 21.75<br>
                        小时工资 = 日工资 ÷ 8<br>
                        工作日加班费 = 小时工资 × 工作日加班小时 × 150%<br>
                        周末加班费 = 小时工资 × 周末加班小时 × 200%<br>
                        节假日加班费 = 小时工资 × 节假日加班小时 × 300%
                    </div>
                </div>
            </section>
        </div>
    </div>
    
    <section class="law-section" id="lawSection">
        <h2 class="section-title"><i class="fas fa-gavel"></i> 法律依据与说明</h2>
        
        <div class="law-item">
            <h3><i class="fas fa-calendar-plus"></i> 2025年新变化</h3>
            <p>根据《国务院关于修改〈全国年节及纪念日放假办法〉的决定》，自2025年1月1日起，全体公民的节日假期由原来的11天增设为13天。</p>
            <p>新的法定节假日为：元旦1天、春节4天（除夕、正月初一至初三）、清明节1天、劳动节2天（5月1日、2日）、端午节1天、中秋节1天、国庆节3天（10月1日至3日）。</p>
            <div class="law-source">依据：人社部《关于职工全年月平均工作时间和工资折算问题的通知》</div>
        </div>
        
        <div class="law-item">
            <h3><i class="fas fa-coins"></i> 加班费支付标准</h3>
            <p>根据《中华人民共和国劳动法》和《工资支付暂行规定》：</p>
            <p>1. 工作日延长工作时间：按照不低于小时工资标准的150%支付。</p>
            <p>2. 休息日安排工作又不能安排补休：按照不低于日或小时工资标准的200%支付。</p>
            <p>3. 法定休假日安排工作：按照不低于日或小时工资标准的300%支付。</p>
            <div class="law-source">
                依据：
                <a href="https://law.mot.gov.cn/showLaw.action?law.id=2982" target="_blank" class="law-link">
                    《中华人民共和国劳动法》第四十四条
                </a>
                和《工资支付暂行规定》（劳部发﹝1994﹞489号）第十三条
            </div>
        </div>
        
        <div class="law-item">
            <h3><i class="fas fa-clock"></i> 工资折算办法</h3>
            <p>根据劳动法第五十一条，法定节假日用人单位应当依法支付工资，即折算日工资、小时工资时不剔除国家规定的法定节假日。</p>
            <p>月计薪天数 = (365天 - 104天休息日) ÷ 12月 = 21.75天。</p>
            <p>日工资 = 月工资收入 ÷ 月计薪天数</p>
            <p>小时工资 = 月工资收入 ÷ (月计薪天数 × 8小时)</p>
            <div class="law-source">
                依据：
                <a href="http://www.mohrss.gov.cn/xxgk2020/fdzdgknr/zcfg/gfxwj/201407/t20140717_136197.html" target="_blank" class="law-link">
                    人社部《关于职工全年月平均工作时间和工资折算问题的通知》
                </a>
            </div>
        </div>
        
        <div class="law-item">
            <h3><i class="fas fa-exclamation-triangle"></i> 重要注意事项</h3>
            <p>1. 本计算器适用于标准工时制。实行综合计算工时制和不定时工时制的加班费计算方式有所不同。</p>
            <p>2. 法定节假日加班，用人单位不能以补休来代替加班工资，必须支付300%的工资报酬。</p>
            <p>3. 休息日加班，用人单位可以安排补休而不支付加班费；不能安排补休的，应支付200%的工资报酬。</p>
            <p>4. 如果认为加班工资未合理支付，可与用人单位协商，或向当地劳动监察部门投诉、申请劳动仲裁。</p>
            <div class="law-source">
                更多信息请参考：
                <a href="http://www.mohrss.gov.cn/" target="_blank" class="law-link">
                    中华人民共和国人力资源和社会保障部官网
                </a>
            </div>
        </div>
    </section>
    
    <div class="footer">
        <p>本计算器根据《中华人民共和国劳动法》及相关法规制作，计算结果仅供参考。实际加班费计算可能受地方规定、劳动合同约定等因素影响。</p>
        <p>© 2025 劳动法加班费计算器 | 数据来源：中华人民共和国人力资源和社会保障部及相关官方文件</p>
        <p>
            官方法规链接：
            <a href="https://law.mot.gov.cn/showLaw.action?law.id=2982" target="_blank">《中华人民共和国劳动法》</a> |
            <a href="http://www.mohrss.gov.cn/" target="_blank">人力资源和社会保障部</a>
        </p>
    </div>

    <!-- 专门用于PDF生成的隐藏内容 -->
    <div id="pdfHeaderTemplate" style="display: none;">
        <div class="pdf-header">
            <h1 style="margin: 0; font-size: 24px;">劳动法加班费计算结果</h1>
            <p style="margin: 10px 0 0 0; font-size: 16px;">生成时间: <span id="pdfGenerationTime"></span></p>
        </div>
    </div>
    
    <div id="pdfFooterTemplate" style="display: none;">
        <div class="pdf-footer">
            <p style="margin: 5px 0;">第 <span id="currentPage"></span> 页 / 共 <span id="totalPages"></span> 页</p>
            <p style="margin: 5px 0;">本计算器根据《中华人民共和国劳动法》及相关法规制作，仅供参考</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calculateBtn = document.getElementById('calculateBtn');
            const downloadTxtBtn = document.getElementById('downloadTxtBtn');
            const downloadPdfBtn = document.getElementById('downloadPdfBtn');
            
            // 计算加班费
            calculateBtn.addEventListener('click', calculateOvertimePay);
            
            // 文本下载功能
            downloadTxtBtn.addEventListener('click', downloadTxtResults);
            
            // PDF下载功能
            downloadPdfBtn.addEventListener('click', downloadPdfResults);
            
            // 初始计算一次
            calculateOvertimePay();
            
            // 输入框变化时自动计算
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', calculateOvertimePay);
            });
            
            function calculateOvertimePay() {
                // 获取输入值
                const monthlySalary = parseFloat(document.getElementById('monthlySalary').value) || 0;
                const weekdayOvertime = parseFloat(document.getElementById('weekdayOvertime').value) || 0;
                const weekendOvertime = parseFloat(document.getElementById('weekendOvertime').value) || 0;
                const holidayOvertime = parseFloat(document.getElementById('holidayOvertime').value) || 0;
                
                // 常量定义
                const WORKING_DAYS_PER_MONTH = 21.75; // 月计薪天数
                const HOURS_PER_DAY = 8;
                
                // 计算日工资和小时工资
                const dailySalary = monthlySalary / WORKING_DAYS_PER_MONTH;
                const hourlySalary = dailySalary / HOURS_PER_DAY;
                
                // 计算各类加班费
                const weekdayOvertimePay = hourlySalary * weekdayOvertime * 1.5; // 150%
                const weekendOvertimePay = hourlySalary * weekendOvertime * 2.0; // 200%
                const holidayOvertimePay = hourlySalary * holidayOvertime * 3.0; // 300%
                
                // 计算总计
                const totalOvertimePay = weekdayOvertimePay + weekendOvertimePay + holidayOvertimePay;
                
                // 更新显示结果
                document.getElementById('dailySalary').textContent = dailySalary.toFixed(2) + ' 元';
                document.getElementById('hourlySalary').textContent = hourlySalary.toFixed(2) + ' 元';
                document.getElementById('weekdayOvertimePay').textContent = weekdayOvertimePay.toFixed(2) + ' 元';
                document.getElementById('weekendOvertimePay').textContent = weekendOvertimePay.toFixed(2) + ' 元';
                document.getElementById('holidayOvertimePay').textContent = holidayOvertimePay.toFixed(2) + ' 元';
                document.getElementById('totalOvertimePay').textContent = totalOvertimePay.toFixed(2) + ' 元';
                
                // 保存结果到本地存储
                const results = {
                    monthlySalary,
                    weekdayOvertime,
                    weekendOvertime,
                    holidayOvertime,
                    dailySalary: dailySalary.toFixed(2),
                    hourlySalary: hourlySalary.toFixed(2),
                    weekdayOvertimePay: weekdayOvertimePay.toFixed(2),
                    weekendOvertimePay: weekendOvertimePay.toFixed(2),
                    holidayOvertimePay: holidayOvertimePay.toFixed(2),
                    totalOvertimePay: totalOvertimePay.toFixed(2),
                    calculationDate: new Date().toLocaleString('zh-CN')
                };
                
                localStorage.setItem('overtimeCalculationResults', JSON.stringify(results));
            }
            
            function downloadTxtResults() {
                // 获取计算结果
                const results = JSON.parse(localStorage.getItem('overtimeCalculationResults')) || {};
                
                // 创建要下载的内容
                const content = `
劳动法加班费计算结果
生成时间：${results.calculationDate || new Date().toLocaleString('zh-CN')}

========== 输入信息 ==========
月工资收入：${results.monthlySalary || 0} 元
工作日加班时长：${results.weekdayOvertime || 0} 小时
周末加班时长：${results.weekendOvertime || 0} 小时
节假日加班时长：${results.holidayOvertime || 0} 小时

========== 计算结果 ==========
日工资：${results.dailySalary || '0.00'} 元
小时工资：${results.hourlySalary || '0.00'} 元
工作日加班费 (150%)：${results.weekdayOvertimePay || '0.00'} 元
周末加班费 (200%)：${results.weekendOvertimePay || '0.00'} 元
节假日加班费 (300%)：${results.holidayOvertimePay || '0.00'} 元
--------------------------------
加班费总计：${results.totalOvertimePay || '0.00'} 元

========== 计算说明 ==========
1. 月计薪天数固定为21.75天
2. 日工资 = 月工资 ÷ 21.75
3. 小时工资 = 日工资 ÷ 8
4. 工作日加班费 = 小时工资 × 工作日加班小时 × 150%
5. 周末加班费 = 小时工资 × 周末加班小时 × 200%
6. 节假日加班费 = 小时工资 × 节假日加班小时 × 300%

========== 法律依据 ==========
根据《中华人民共和国劳动法》和《工资支付暂行规定》：
1. 工作日延长工作时间：按不低于小时工资的150%支付
2. 休息日工作又不能安排补休：按不低于日或小时工资的200%支付
3. 法定休假日工作：按不低于日或小时工资的300%支付

官方法规链接：
- 《中华人民共和国劳动法》：https://law.mot.gov.cn/showLaw.action?law.id=2982
- 人力资源和社会保障部官网：http://www.mohrss.gov.cn/

注：本计算结果仅供参考。实际加班费计算可能受地方规定、劳动合同约定等因素影响。
                `;
                
                // 创建Blob对象
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                
                // 创建下载链接
                const downloadLink = document.createElement('a');
                downloadLink.href = URL.createObjectURL(blob);
                downloadLink.download = `加班费计算结果_${new Date().toISOString().split('T')[0]}.txt`;
                
                // 触发下载
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
            }
            
            async function downloadPdfResults() {
                try {
                    // 1. 显示加载提示
                    const originalText = downloadPdfBtn.innerHTML;
                    downloadPdfBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 生成PDF中...';
                    downloadPdfBtn.disabled = true;

                    // 2. 创建PDF实例 - 使用最简化的参数
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4');

                    // 3. 捕获主内容区域为图片
                    const contentToExport = document.getElementById('contentToExport');
                    
                    // 使用更可靠的 html2canvas 配置
                    const canvas1 = await html2canvas(contentToExport, {
                        scale: 2, // 提高清晰度
                        useCORS: true, // 处理跨域资源（如字体图标）
                        backgroundColor: '#ffffff',
                        logging: false, // 关闭控制台日志，减少干扰
                        // 明确指定图像格式，确保数据有效
                        imageTimeout: 0 // 防止图像加载超时
                    });

                    // 关键检查：确保canvas已成功生成
                    if (!canvas1 || canvas1.width === 0) {
                        throw new Error('页面内容捕获失败，请重试。');
                    }

                    // 将canvas转换为Data URL - 使用PNG格式以确保兼容性
                    const imgData1 = canvas1.toDataURL('image/png');

                    // 计算图片在PDF中的尺寸 (A4纸宽度约210mm，左右留边各10mm)
                    const pdfPageWidth = 210;
                    const margin = 10;
                    const imgWidth = pdfPageWidth - 2 * margin;
                    const imgHeight = (canvas1.height * imgWidth) / canvas1.width;

                    // 4. 将图片添加到PDF第一页
                    pdf.addImage(imgData1, 'PNG', margin, margin, imgWidth, imgHeight);

                    // 5. 捕获法律依据部分，并添加到新页面
                    const lawSection = document.getElementById('lawSection');
                    const canvas2 = await html2canvas(lawSection, {
                        scale: 2,
                        useCORS: true,
                        backgroundColor: '#ffffff',
                        logging: false,
                        imageTimeout: 0
                    });

                    if (canvas2 && canvas2.width > 0) {
                        const imgData2 = canvas2.toDataURL('image/png');
                        const imgWidth2 = pdfPageWidth - 2 * margin;
                        const imgHeight2 = (canvas2.height * imgWidth2) / canvas2.width;

                        // 添加新页
                        pdf.addPage();
                        // 将法律依据部分添加到第二页
                        pdf.addImage(imgData2, 'PNG', margin, margin, imgWidth2, imgHeight2);
                    }

                    // 6. 保存PDF文件
                    pdf.save(`加班费计算结果_${new Date().toLocaleDateString('zh-CN')}.pdf`);

                } catch (error) {
                    console.error('生成PDF时发生错误:', error);
                    alert(`生成PDF失败：${error.message}\n请确保页面内容已完全加载后重试。`);
                } finally {
                    // 7. 无论成功与否，都恢复按钮状态
                    downloadPdfBtn.innerHTML = '<i class="fas fa-file-pdf"></i> 导出完整PDF';
                    downloadPdfBtn.disabled = false;
                }
            }
        });
    </script>
</body>
</html>